<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings // THE ARCHIVE</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="styles.css">
    <style>
        .settings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 24px; }
        .settings-card { padding: 28px; }
        .settings-card h3 { display: flex; align-items: center; gap: 10px; font-size: 1.1rem; margin-bottom: 20px; }
        .settings-card h3 span { font-size: 1.3rem; }
        
        .status-box { display: flex; align-items: center; gap: 12px; padding: 16px; border-radius: var(--radius-sm); margin-bottom: 20px; }
        .status-box.ok { background: rgba(16,185,129,0.1); }
        .status-box.off { background: rgba(245,158,11,0.1); }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; }
        .status-box.ok .status-dot { background: var(--success); box-shadow: 0 0 0 3px rgba(16,185,129,0.2); }
        .status-box.off .status-dot { background: var(--warning); }
        .status-info strong { display: block; font-size: 0.95rem; margin-bottom: 2px; }
        .status-info span { font-size: 0.85rem; color: var(--ink-light); }
        
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-light); }
        .data-item { text-align: center; padding: 16px; background: var(--paper-warm); border-radius: var(--radius-sm); }
        .data-item .val { font-family: var(--font-display); font-size: 1.5rem; font-weight: 700; color: var(--primary); }
        .data-item .lbl { font-size: 0.8rem; color: var(--ink-light); margin-top: 4px; }
        
        .danger { margin-top: 20px; padding: 16px; background: rgba(239,68,68,0.05); border: 1px solid rgba(239,68,68,0.2); border-radius: var(--radius-sm); }
        .danger h4 { font-size: 0.9rem; color: var(--danger); margin-bottom: 8px; }
        .danger p { font-size: 0.85rem; color: var(--ink-light); margin-bottom: 12px; }
        
        .about { text-align: center; padding: 40px 20px; }
        .about-logo { width: 72px; height: 72px; margin: 0 auto 16px; background: var(--ink); border-radius: 18px; display: flex; align-items: center; justify-content: center; }
        .about-logo span { font-family: var(--font-display); font-size: 2rem; font-weight: 700; color: white; }
        .about h3 { font-family: var(--font-display); font-size: 1.4rem; margin-bottom: 4px; }
        .about .ver { font-family: var(--font-mono); font-size: 0.85rem; color: var(--ink-light); margin-bottom: 16px; }
        .about p { font-size: 0.9rem; color: var(--ink-light); line-height: 1.7; }
    </style>
</head>
<body>
    <nav class="nav-bar">
        <div class="nav-brand"><span class="brand-serif">THE ARCHIVE</span><span class="brand-sub">PSAT MASTERY SYSTEM</span></div>
        <div class="nav-links">
            <a href="index.html" class="nav-link">Dashboard</a>
            <a href="solve.html" class="nav-link">Solve</a>
            <a href="stats.html" class="nav-link">Analytics</a>
            <a href="history.html" class="nav-link">Records</a>
            <a href="settings.html" class="nav-link active">Settings</a>
        </div>
        <div class="nav-status"><span class="status-dot" id="statusDot"></span><span class="status-text" id="statusText">Syncing...</span></div>
    </nav>

    <main class="main-content">
        <header class="page-header">
            <div class="header-tag">Configuration</div>
            <h1 class="page-title">Settings</h1>
            <p class="page-subtitle">ì•± ì„¤ì • ë° ë°ì´í„° ê´€ë¦¬</p>
        </header>

        <div class="settings-grid">
            <div class="card settings-card">
                <h3><span>ğŸ”¥</span> Firebase</h3>
                <div class="status-box" id="fbStatus">
                    <div class="status-dot"></div>
                    <div class="status-info">
                        <strong id="fbTitle">Checking...</strong>
                        <span id="fbDesc">ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘</span>
                    </div>
                </div>
                <p style="font-size:0.9rem;color:var(--ink-light);line-height:1.7">Firebaseê°€ í•˜ë“œì½”ë”©ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆì–´ ìë™ìœ¼ë¡œ ì‹¤ì‹œê°„ ë™ê¸°í™”ë©ë‹ˆë‹¤.</p>
                <div class="data-grid">
                    <div class="data-item"><div class="val" id="dSessions">0</div><div class="lbl">ì €ì¥ëœ ì„¸ì…˜</div></div>
                    <div class="data-item"><div class="val" id="dKeys">0</div><div class="lbl">ì •ë‹µ í‚¤</div></div>
                </div>
            </div>

            <div class="card settings-card">
                <h3><span>ğŸ’¾</span> Data</h3>
                <div class="form-group"><button class="btn btn-secondary btn-block" onclick="exportAll()">ğŸ“¥ ì „ì²´ ë°ì´í„° ë‚´ë³´ë‚´ê¸° (JSON)</button></div>
                <div class="form-group"><button class="btn btn-secondary btn-block" onclick="document.getElementById('importFile').click()">ğŸ“¤ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (JSON)</button><input type="file" id="importFile" accept=".json" style="display:none"></div>
                <div class="danger">
                    <h4>âš ï¸ Danger Zone</h4>
                    <p>ëª¨ë“  í•™ìŠµ ê¸°ë¡ê³¼ ì •ë‹µ í‚¤ê°€ ì˜êµ¬ ì‚­ì œë©ë‹ˆë‹¤.</p>
                    <button class="btn btn-danger btn-block" onclick="clearAll()">ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì‚­ì œ</button>
                </div>
            </div>

            <div class="card settings-card">
                <div class="about">
                    <div class="about-logo"><span>A</span></div>
                    <h3>THE ARCHIVE</h3>
                    <p class="ver">PSAT Mastery System v4.0</p>
                    <p>PSAT ê¸°ì¶œë¬¸ì œ í•™ìŠµì„ ìœ„í•œ ì•„ì¹´ì´ë¸Œ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.<br>AI ë‹µì•ˆ ì¶”ì¶œ, Firebase ì‹¤ì‹œê°„ ë™ê¸°í™”,<br>ê³ ê¸‰ í†µê³„ ì‹œê°í™”ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>
    </main>

    <script src="app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            initApp();
            setTimeout(loadSettings, 200);
            document.getElementById('importFile').addEventListener('change', importData);
        });
        
        function loadSettings() {
            const box = document.getElementById('fbStatus');
            const title = document.getElementById('fbTitle');
            const desc = document.getElementById('fbDesc');
            
            if (isConnected) {
                box.className = 'status-box ok';
                title.textContent = 'Connected';
                desc.textContent = 'ì‹¤ì‹œê°„ ë™ê¸°í™” í™œì„±í™”ë¨';
            } else {
                box.className = 'status-box off';
                title.textContent = 'Offline';
                desc.textContent = 'ë¡œì»¬ ì €ì¥ì†Œ ì‚¬ìš© ì¤‘';
            }
            
            document.getElementById('dSessions').textContent = historyData.length;
            document.getElementById('dKeys').textContent = Object.keys(answerKeys).length;
        }
        
        function exportAll() {
            const data = { history: historyData, answerKeys, exportDate: new Date().toISOString(), version: '4.0' };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `psat_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            showToast('ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì™„ë£Œ', 'success');
        }
        
        function importData(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = ev => {
                try {
                    const data = JSON.parse(ev.target.result);
                    if (data.history) { historyData = data.history; localStorage.setItem('psatHistory', JSON.stringify(historyData)); }
                    if (data.answerKeys) { answerKeys = data.answerKeys; localStorage.setItem('psatAnswerKeys', JSON.stringify(answerKeys)); }
                    loadSettings();
                    showToast('ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ!', 'success');
                } catch { showToast('ì˜ëª»ëœ íŒŒì¼ í˜•ì‹', 'error'); }
            };
            reader.readAsText(file);
            e.target.value = '';
        }
        
        function clearAll() {
            if (!confirm('ì •ë§ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            if (!confirm('ë§ˆì§€ë§‰ í™•ì¸: ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) return;
            historyData = []; answerKeys = {};
            localStorage.removeItem('psatHistory');
            localStorage.removeItem('psatAnswerKeys');
            loadSettings();
            showToast('ëª¨ë“  ë°ì´í„° ì‚­ì œë¨', 'success');
        }
    </script>
</body>
</html>
